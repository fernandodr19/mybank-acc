# Mybank accoutns :bank: :moneybag:

[![GitHub Workflow Status](https://img.shields.io/github/workflow/status/fernandodr19/mybank-acc/Main?style=flat-square)](https://github.com/fernandodr19/mybank-acc/actions?query=workflow%3AMain)
[![Go Report Card](https://goreportcard.com/badge/github.com/fernandodr19/mybank-acc)](https://goreportcard.com/report/github.com/fernandodr19/mybank-acc)


Over engineered bank accounts microservice. It was designed following DDD and clean arch principles protecting its domain logic from everything else. Don't get to much attached to the choice of frameworks and drivers because that's now really the point. They could be easily replaced by any other without having to change a single domain line of code. 

This microservice handles requests through both gRPC and REST API. It creates and retrieves an user account and process movimentations over it.

----------------------------------

- [How to(s)](#make-yourself-at-home)
- [API doc](#api-doc) 
- [Project tree](#project-tree) 
- [Database schema](#database-schema) 

----------------------------------

### Make yourself at home
For some of the following steps [Golang](https://golang.org/doc/install) or [Docker](https://www.docker.com/) are gonna be necessary.

##### Run application 100% on Docker (no need for Golang in this case)
``$ make docker-run``

##### Run application dependencies on background using Docker
``$ make setup-dev``

##### Run it locally
``$ go run cmd/api/*``

##### Buid it
``$ make compile`` (generates binary output at ./build)

##### Run tests
``$ make test``

##### Run linter
``$ make metalint``

----------------------------------

### API doc
Once application is running API docs can be found at [Swagger UI](http://localhost:3001/docs/v1/mybank/accounts/swagger/index.html).

- Create acount
```curl
curl -i -X POST http://localhost:3001/api/v1/accounts -d '{"document_number": "12345678900"}'
```
- Get acount
```curl
curl -i -X GET http://localhost:3001/api/v1/accounts/2a5d1c6a-f757-4cd9-bc4c-0514de06c2fc
```

----------------------------------

### Project tree
```bash
$ tree
├── cmd # everything starts here: main files are located here
├── docs # autogenerated documentation
├── pkg
│   ├── config # centralized configuration of the project
│   ├── domain
│   │   ├── entities # domain entities and aggregates
│   │   ├── error.go # some domain errors
│   │   ├── usecases # domain use cases
│   │   └── vos      # value objects package
│   ├── gateway
│   │   ├── api  # REST API infrastructure layer
│   │   ├── db   # database infrastructure layer
│   │   └── grpc # gRPC server infrastructure layer
│   └── tests # integration tests and test helpers to be used within the project
│       └── servers # fake servers for integration testing porpuses
```
### Database schema
```
                                 Table "public.accounts"
      Column      |           Type           | Nullable |      Default       
------------------+--------------------------+----------+--------------------
 id               | uuid                     | not null | uuid_generate_v4()
 document         | text                     | not null | 
 balance          | bigint                   | not null | 0
 available_credit | bigint                   | not null | 0
 created_at       | timestamp with time zone | not null | CURRENT_TIMESTAMP
 updated_at       | timestamp with time zone | not null | CURRENT_TIMESTAMP
Indexes:
    "accounts_pkey" PRIMARY KEY, btree (id)
    "accounts_document_key" UNIQUE CONSTRAINT, btree (document)
Triggers:
    set_timestamp_accounts BEFORE UPDATE ON accounts FOR EACH ROW EXECUTE FUNCTION trigger_set_timestamp()

```